{% extends "base.html" %}
{% block content %}
<div class="register-container">
    <div class="register-card">
        <div class="register-header">
            <h3 class="register-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–º–ø–∞–Ω–∏–∏</h3>
            <p class="register-subtitle">B2B –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤</p>
        </div>

        <form method="post" class="register-form" id="registerForm">
            <!-- –õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="form-section">
                <div class="input-group">
                    <input name="full_name" placeholder="–§–ò–û –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–≥–æ –ª–∏—Ü–∞" required class="form-input" id="fullName">
                    <span class="input-icon">üë§</span>
                    <div class="input-hint">–ù–∞–ø—Ä–∏–º–µ—Ä: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á</div>
                </div>
            </div>

            <!-- –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
            <div class="form-section">
                <!-- –ò–ù–ù -->
                <div class="input-group">
                    <input name="inn" placeholder="–ò–ù–ù –∫–æ–º–ø–∞–Ω–∏–∏" required class="form-input" id="inn" maxlength="12" pattern="\d{10,12}">
                    <span class="input-icon">üìä</span>
                    <button type="button" class="inn-verify-btn" id="verifyInn" title="–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ò–ù–ù">
                        <i class="fas fa-search"></i>
                    </button>
                    <div class="input-hint">10 —Ü–∏—Ñ—Ä –¥–ª—è —é—Ä–ª–∏—Ü, 12 –¥–ª—è –ò–ü</div>
                    <div class="inn-status" id="innStatus"></div>
                </div>

                <!-- Email -->
                <div class="input-group">
                    <input name="email" type="email" placeholder="–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–æ—á—Ç–∞" required class="form-input" id="email">
                    <span class="input-icon">üìß</span>
                    <div class="input-hint">–¢–æ–ª—å–∫–æ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –¥–æ–º–µ–Ω—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏</div>
                </div>

                <!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
                <div class="input-group">
                    <input name="phone" type="tel" placeholder="–ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" required class="form-input" id="phone">
                    <span class="input-icon">üì±</span>
                    <div class="input-hint">–§–æ—Ä–º–∞—Ç: +7 (XXX) XXX-XX-XX</div>
                </div>
            </div>

            <!-- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å -->
            <div class="form-section">
                <h4 class="section-title">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h4>

                <!-- –ü–∞—Ä–æ–ª—å -->
                <div class="input-group">
                    <input name="password" placeholder="–°–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å" type="password" required class="form-input" id="password">
                    <span class="input-icon">üîí</span>
                    <button type="button" class="password-toggle" id="togglePassword">
                        <i class="fas fa-eye"></i>
                    </button>
                    <div class="password-strength" id="passwordStrength">
                        <div class="strength-bar">
                            <div class="strength-fill" id="strengthFill"></div>
                        </div>
                        <div class="strength-text" id="strengthText">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</div>
                    </div>
                    <div class="password-requirements" id="passwordRequirements">
                        <div class="requirement" id="reqLength">‚úì –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤</div>
                        <div class="requirement" id="reqUpper">‚úì –ó–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞</div>
                        <div class="requirement" id="reqLower">‚úì –°—Ç—Ä–æ—á–Ω–∞—è –±—É–∫–≤–∞</div>
                        <div class="requirement" id="reqNumber">‚úì –¶–∏—Ñ—Ä–∞</div>
                        <div class="requirement" id="reqSpecial">‚úì –°–ø–µ—Ü—Å–∏–º–≤–æ–ª</div>
                    </div>
                </div>

                <!-- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è -->
                <div class="input-group">
                    <input name="confirm_password" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" type="password" required class="form-input" id="confirmPassword">
                    <span class="input-icon">üîí</span>
                    <button type="button" class="password-toggle" id="toggleConfirmPassword">
                        <i class="fas fa-eye"></i>
                    </button>
                    <div class="input-hint" id="confirmHint">–ü–∞—Ä–æ–ª–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å</div>
                </div>
            </div>

            <div class="terms-group">
                <label class="checkbox-label">
                    <input type="checkbox" required class="checkbox-input" id="termsCheckbox">
                    <span class="checkmark"></span>
                    –Ø –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é, —á—Ç–æ —è–≤–ª—è—é—Å—å —É–ø–æ–ª–Ω–æ–º–æ—á–µ–Ω–Ω—ã–º –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª–µ–º –∫–æ–º–ø–∞–Ω–∏–∏ –∏ –ø—Ä–∏–Ω–∏–º–∞—é
                    <a href="#" class="terms-link">–¥–æ–≥–æ–≤–æ—Ä –æ—Ñ–µ—Ä—Ç—ã</a> –∏
                    <a href="#" class="terms-link">–ø–æ–ª–∏—Ç–∏–∫—É –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
                </label>
            </div>

            <button type="submit" class="submit-btn" id="submitBtn" disabled>
                <span class="btn-text">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é</span>
                <span class="btn-icon">‚Üí</span>
            </button>
        </form>

        <div class="register-footer">
            <p class="login-link">–£–∂–µ –µ—Å—Ç—å –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç? <a href="{{ url_for('buyer.login') }}" class="link">–í–æ–π—Ç–∏</a></p>
        </div>
    </div>
</div>

<style>
.register-container {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 20px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.register-card {
    background: white;
    padding: 50px 40px;
    border-radius: 24px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    width: 100%;
    max-width: 450px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.register-header {
    text-align: center;
    margin-bottom: 40px;
}

.register-title {
    color: #2d3748;
    margin-bottom: 10px;
    font-size: 28px;
    font-weight: 700;
}

.register-subtitle {
    color: #718096;
    font-size: 16px;
    margin: 0;
}

.register-form {
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.input-group {
    position: relative;
}

.form-input {
    width: 100%;
    padding: 16px 80px 16px 20px;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-size: 16px;
    transition: all 0.3s ease;
    background: #f8fafc;
    box-sizing: border-box;
    font-family: inherit;
}

.form-input:focus {
    outline: none;
    border-color: #667eea;
    background: white;
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    transform: translateY(-2px);
}

.form-input::placeholder {
    color: #a0aec0;
}

.input-icon {
    position: absolute;
    right: 50px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 18px;
    color: #a0aec0;
}

/* Password Toggle Button */
.password-toggle {
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: #a0aec0;
    cursor: pointer;
    padding: 5px;
    border-radius: 4px;
    transition: all 0.3s ease;
    font-size: 16px;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.password-toggle:hover {
    color: #667eea;
    background: rgba(102, 126, 234, 0.1);
}

.password-toggle:active {
    transform: translateY(-50%) scale(0.95);
}

.input-hint {
    font-size: 12px;
    color: #718096;
    margin-top: 5px;
    margin-left: 5px;
}

/* Password Strength */
.password-strength {
    margin-top: 8px;
    display: none;
}

.password-strength.show {
    display: block;
}

.strength-bar {
    height: 4px;
    background: #e2e8f0;
    border-radius: 2px;
    overflow: hidden;
    margin-bottom: 4px;
}

.strength-fill {
    height: 100%;
    width: 0%;
    transition: all 0.3s ease;
    border-radius: 2px;
}

.strength-fill.weak {
    width: 25%;
    background: #e53e3e;
}

.strength-fill.fair {
    width: 50%;
    background: #dd6b20;
}

.strength-fill.good {
    width: 75%;
    background: #d69e2e;
}

.strength-fill.strong {
    width: 100%;
    background: #38a169;
}

.strength-text {
    font-size: 11px;
    color: #718096;
    text-align: right;
}

/* Password Requirements */
.password-requirements {
    margin-top: 8px;
    display: none;
}

.password-requirements.show {
    display: block;
}

.requirement {
    font-size: 11px;
    color: #e53e3e;
    margin-bottom: 2px;
    transition: color 0.3s ease;
}

.requirement.met {
    color: #38a169;
}

.terms-group {
    margin: 10px 0;
}

.checkbox-label {
    display: flex;
    align-items: flex-start;
    cursor: pointer;
    font-size: 14px;
    color: #4a5568;
    line-height: 1.4;
}

.checkbox-input {
    display: none;
}

.checkmark {
    min-width: 18px;
    height: 18px;
    border: 2px solid #e2e8f0;
    border-radius: 4px;
    margin-right: 10px;
    margin-top: 2px;
    position: relative;
    transition: all 0.3s ease;
    flex-shrink: 0;
}

.checkbox-input:checked + .checkmark {
    background: #667eea;
    border-color: #667eea;
}

.checkbox-input:checked + .checkmark::after {
    content: '‚úì';
    position: absolute;
    color: white;
    font-size: 12px;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.terms-link {
    color: #667eea;
    text-decoration: none;
    font-weight: 500;
}

.terms-link:hover {
    text-decoration: underline;
}

.submit-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 18px;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-top: 10px;
    font-family: inherit;
}

.submit-btn:hover:not(:disabled) {
    transform: translateY(-3px);
    box-shadow: 0 12px 25px rgba(102, 126, 234, 0.4);
}

.submit-btn:active:not(:disabled) {
    transform: translateY(-1px);
}

.submit-btn:disabled {
    background: #cbd5e0;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.btn-icon {
    font-size: 18px;
    transition: transform 0.3s ease;
}

.submit-btn:hover:not(:disabled) .btn-icon {
    transform: translateX(3px);
}

.register-footer {
    text-align: center;
    margin-top: 30px;
    padding-top: 25px;
    border-top: 1px solid #e2e8f0;
}

.login-link {
    color: #718096;
    font-size: 15px;
    margin: 0;
}

.link {
    color: #667eea;
    text-decoration: none;
    font-weight: 600;
}

.link:hover {
    text-decoration: underline;
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.register-card {
    animation: fadeIn 0.6s ease-out;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 480px) {
    .register-card {
        padding: 30px 20px;
        margin: 10px;
        border-radius: 16px;
    }

    .register-title {
        font-size: 24px;
    }

    .form-input {
        padding: 14px 70px 14px 16px;
    }

    .submit-btn {
        padding: 16px;
    }

.form-section {
    margin-bottom: 30px;
    padding: 20px;
    background: #f8fafc;
    border-radius: 12px;
    border: 1px solid #e2e8f0;
}

.section-title {
    margin: 0 0 15px 0;
    font-size: 16px;
    font-weight: 600;
    color: #2d3748;
    display: flex;
    align-items: center;
    gap: 8px;
}

.section-title::before {
    content: '';
    width: 4px;
    height: 16px;
    background: #667eea;
    border-radius: 2px;
}

/* –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ò–ù–ù */
.inn-verify-btn {
    position: absolute;
    right: 50px;
    top: 50%;
    transform: translateY(-50%);
    background: #667eea;
    border: none;
    color: white;
    cursor: pointer;
    padding: 6px;
    border-radius: 6px;
    transition: all 0.3s ease;
    font-size: 12px;
    width: 26px;
    height: 26px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.inn-verify-btn:hover {
    background: #5a6fd8;
    transform: translateY(-50%) scale(1.05);
}

.inn-verify-btn:disabled {
    background: #cbd5e0;
    cursor: not-allowed;
    transform: none;
}

.inn-status {
    font-size: 12px;
    margin-top: 5px;
    padding: 4px 8px;
    border-radius: 4px;
    display: none;
}

.inn-status.verified {
    display: block;
    background: #c6f6d5;
    color: #22543d;
    border: 1px solid #9ae6b4;
}

.inn-status.error {
    display: block;
    background: #fed7d7;
    color: #742a2a;
    border: 1px solid #feb2b2;
}

.inn-status.loading {
    display: block;
    background: #bee3f8;
    color: #1a365d;
    border: 1px solid #90cdf4;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
@media (max-width: 480px) {
    .form-section {
        padding: 15px;
        margin-bottom: 20px;
    }

    .form-input {
        padding: 14px 70px 14px 16px;
    }
}
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('password');
    const confirmInput = document.getElementById('confirmPassword');
    const togglePassword = document.getElementById('togglePassword');
    const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
    const passwordStrength = document.getElementById('passwordStrength');
    const strengthFill = document.getElementById('strengthFill');
    const strengthText = document.getElementById('strengthText');
    const passwordRequirements = document.getElementById('passwordRequirements');
    const submitBtn = document.getElementById('submitBtn');
    const termsCheckbox = document.getElementById('termsCheckbox');

    // –≠–ª–µ–º–µ–Ω—Ç—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –ø–∞—Ä–æ–ª—é
    const reqLength = document.getElementById('reqLength');
    const reqUpper = document.getElementById('reqUpper');
    const reqLower = document.getElementById('reqLower');
    const reqNumber = document.getElementById('reqNumber');
    const reqSpecial = document.getElementById('reqSpecial');
    const confirmHint = document.getElementById('confirmHint');

    // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
    function togglePasswordVisibility(input, button) {
        const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
        input.setAttribute('type', type);

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É
        const icon = button.querySelector('i');
        if (type === 'text') {
            icon.className = 'fas fa-eye-slash';
            button.title = '–°–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å';
        } else {
            icon.className = 'fas fa-eye';
            button.title = '–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞—Ä–æ–ª—å';
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–∞—Ä–æ–ª—è
    togglePassword.addEventListener('click', function() {
        togglePasswordVisibility(passwordInput, this);
    });

    toggleConfirmPassword.addEventListener('click', function() {
        togglePasswordVisibility(confirmInput, this);
    });

    function checkPasswordStrength(password) {
        let strength = 0;
        const requirements = {
            length: password.length >= 8,
            upper: /[A-Z]/.test(password),
            lower: /[a-z]/.test(password),
            number: /[0-9]/.test(password),
            special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
        };

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
        reqLength.classList.toggle('met', requirements.length);
        reqUpper.classList.toggle('met', requirements.upper);
        reqLower.classList.toggle('met', requirements.lower);
        reqNumber.classList.toggle('met', requirements.number);
        reqSpecial.classList.toggle('met', requirements.special);

        // –ü–æ–¥—Å—á–µ—Ç —Å–∏–ª—ã
        if (requirements.length) strength++;
        if (requirements.upper) strength++;
        if (requirements.lower) strength++;
        if (requirements.number) strength++;
        if (requirements.special) strength++;

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–ª—ã
        if (password.length === 0) {
            passwordStrength.classList.remove('show');
            passwordRequirements.classList.remove('show');
            strengthFill.className = 'strength-fill';
            strengthText.textContent = '–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å';
        } else {
            passwordStrength.classList.add('show');
            passwordRequirements.classList.add('show');

            if (strength <= 1) {
                strengthFill.className = 'strength-fill weak';
                strengthText.textContent = '–°–ª–∞–±—ã–π';
                strengthText.style.color = '#e53e3e';
            } else if (strength <= 2) {
                strengthFill.className = 'strength-fill fair';
                strengthText.textContent = '–°—Ä–µ–¥–Ω–∏–π';
                strengthText.style.color = '#dd6b20';
            } else if (strength <= 3) {
                strengthFill.className = 'strength-fill good';
                strengthText.textContent = '–•–æ—Ä–æ—à–∏–π';
                strengthText.style.color = '#d69e2e';
            } else {
                strengthFill.className = 'strength-fill strong';
                strengthText.textContent = '–ù–∞–¥–µ–∂–Ω—ã–π';
                strengthText.style.color = '#38a169';
            }
        }

        return strength >= 3; // –ú–∏–Ω–∏–º—É–º 3 –∏–∑ 5 —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
    }

    function checkPasswordMatch() {
        const password = passwordInput.value;
        const confirm = confirmInput.value;

        if (confirm.length === 0) {
            confirmHint.textContent = '–ü–∞—Ä–æ–ª–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å';
            confirmHint.style.color = '#718096';
            return false;
        } else if (password === confirm) {
            confirmHint.textContent = '–ü–∞—Ä–æ–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
            confirmHint.style.color = '#38a169';
            return true;
        } else {
            confirmHint.textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
            confirmHint.style.color = '#e53e3e';
            return false;
        }
    }

    function validateForm() {
        const isPasswordStrong = checkPasswordStrength(passwordInput.value);
        const isPasswordMatch = checkPasswordMatch();
        const isTermsAccepted = termsCheckbox.checked;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
        const fullName = document.getElementById('fullName').value.trim();
        const email = document.getElementById('email').value.trim();
        const phone = document.getElementById('phone').value.trim();

        const allFieldsFilled = fullName && email && phone && passwordInput.value && confirmInput.value;

        submitBtn.disabled = !(isPasswordStrong && isPasswordMatch && isTermsAccepted && allFieldsFilled);
    }

    // –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π
    passwordInput.addEventListener('input', validateForm);
    confirmInput.addEventListener('input', validateForm);
    termsCheckbox.addEventListener('change', validateForm);

    // –°–ª—É—à–∞—Ç–µ–ª–∏ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã
    const formInputs = document.querySelectorAll('.form-input, .checkbox-input');
    formInputs.forEach(input => {
        input.addEventListener('input', validateForm);
        input.addEventListener('change', validateForm);
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    validateForm();
});

document.addEventListener('DOMContentLoaded', function() {
    const innInput = document.getElementById('inn');
    const verifyInnBtn = document.getElementById('verifyInn');
    const innStatus = document.getElementById('innStatus');
    const fullNameInput = document.getElementById('fullName');

    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ò–ù–ù —á–µ—Ä–µ–∑ –Ω–∞—à —Å–µ—Ä–≤–µ—Ä
    async function verifyInn() {
        const inn = innInput.value.trim();

        if (!inn || inn.length < 10) {
            showInnStatus('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ò–ù–ù (10-12 —Ü–∏—Ñ—Ä)', 'error');
            return;
        }

        // –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞
        if (!/^\d{10,12}$/.test(inn)) {
            showInnStatus('–ò–ù–ù –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã', 'error');
            return;
        }

        showInnStatus('–ü—Ä–æ–≤–µ—Ä—è–µ–º –ò–ù–ù...', 'loading');
        verifyInnBtn.disabled = true;

        try {
            const response = await fetch('/verify_inn', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ inn: inn })
            });

            const data = await response.json();

            if (data.success) {
                // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–∏
                if (data.company_name) {
                    showInnStatus(`‚úì ${data.company_name}`, 'verified');
                } else {
                    showInnStatus('‚úì –ò–ù–ù –ø—Ä–æ–≤–µ—Ä–µ–Ω', 'verified');
                }

                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
                // if (data.full_name && !fullNameInput.value) {
                //     fullNameInput.value = data.full_name;
                // }
            } else {
                showInnStatus(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ò–ù–ù', 'error');
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ò–ù–ù:', error);
            showInnStatus('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ò–ù–ù –≤—Ä—É—á–Ω—É—é', 'error');
        } finally {
            verifyInnBtn.disabled = false;
        }
    }

    function showInnStatus(message, type) {
        innStatus.textContent = message;
        innStatus.className = `inn-status ${type}`;
    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –ò–ù–ù –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
    function validateInn(inn) {
        if (!inn) return false;

        inn = inn.trim();
        if (!/^\d+$/.test(inn)) return false;

        if (inn.length === 10) {
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –ò–ù–ù —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –ª–∏—Ü–∞
            const coefficients = [2, 4, 10, 3, 5, 9, 4, 6, 8];
            let sum = 0;
            for (let i = 0; i < 9; i++) {
                sum += parseInt(inn[i]) * coefficients[i];
            }
            const control = (sum % 11) % 10;
            return control === parseInt(inn[9]);
        } else if (inn.length === 12) {
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –ò–ù–ù –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—è
            const coefficients1 = [7, 2, 4, 10, 3, 5, 9, 4, 6, 8];
            const coefficients2 = [3, 7, 2, 4, 10, 3, 5, 9, 4, 6, 8];

            let sum1 = 0, sum2 = 0;
            for (let i = 0; i < 10; i++) {
                sum1 += parseInt(inn[i]) * coefficients1[i];
            }
            for (let i = 0; i < 11; i++) {
                sum2 += parseInt(inn[i]) * coefficients2[i];
            }

            const control1 = (sum1 % 11) % 10;
            const control2 = (sum2 % 11) % 10;

            return control1 === parseInt(inn[10]) && control2 === parseInt(inn[11]);
        }

        return false;
    }

    // –°–æ–±—ã—Ç–∏—è –¥–ª—è –ò–ù–ù
    verifyInnBtn.addEventListener('click', verifyInn);

    innInput.addEventListener('input', function() {
        innStatus.className = 'inn-status';
        validateForm();

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –≤–≤–æ–¥–µ 10 –∏–ª–∏ 12 —Ü–∏—Ñ—Ä
        const inn = this.value.trim();
        if ((inn.length === 10 || inn.length === 12) && /^\d+$/.test(inn)) {
            verifyInn();
        }
    });

    // –û–±–Ω–æ–≤–ª—è–µ–º validateForm —á—Ç–æ–±—ã –≤–∫–ª—é—á–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ò–ù–ù
    const originalValidateForm = validateForm;
    window.validateForm = function() {
        const isValid = originalValidateForm();
        const inn = innInput.value.trim();

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ò–ù–ù
        const isInnValid = validateInn(inn);
        if (inn && !isInnValid) {
            showInnStatus('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ò–ù–ù', 'error');
        }

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
        const fullName = fullNameInput.value.trim();

        submitBtn.disabled = !(isValid && isInnValid && fullName);

        return isValid && isInnValid;
    };

    // –û—Å—Ç–∞–ª—å–Ω–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥...
    const passwordInput = document.getElementById('password');
    const confirmInput = document.getElementById('confirmPassword');
    const togglePassword = document.getElementById('togglePassword');
    const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
    const passwordStrength = document.getElementById('passwordStrength');
    const strengthFill = document.getElementById('strengthFill');
    const strengthText = document.getElementById('strengthText');
    const passwordRequirements = document.getElementById('passwordRequirements');
    const submitBtn = document.getElementById('submitBtn');
    const termsCheckbox = document.getElementById('termsCheckbox');

    // –≠–ª–µ–º–µ–Ω—Ç—ã —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –∫ –ø–∞—Ä–æ–ª—é
    const reqLength = document.getElementById('reqLength');
    const reqUpper = document.getElementById('reqUpper');
    const reqLower = document.getElementById('reqLower');
    const reqNumber = document.getElementById('reqNumber');
    const reqSpecial = document.getElementById('reqSpecial');
    const confirmHint = document.getElementById('confirmHint');

    // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
    function togglePasswordVisibility(input, button) {
        const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
        input.setAttribute('type', type);

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É
        const icon = button.querySelector('i');
        if (type === 'text') {
            icon.className = 'fas fa-eye-slash';
            button.title = '–°–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å';
        } else {
            icon.className = 'fas fa-eye';
            button.title = '–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞—Ä–æ–ª—å';
        }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–∞—Ä–æ–ª—è
    togglePassword.addEventListener('click', function() {
        togglePasswordVisibility(passwordInput, this);
    });

    toggleConfirmPassword.addEventListener('click', function() {
        togglePasswordVisibility(confirmInput, this);
    });

    function checkPasswordStrength(password) {
        let strength = 0;
        const requirements = {
            length: password.length >= 8,
            upper: /[A-Z]/.test(password),
            lower: /[a-z]/.test(password),
            number: /[0-9]/.test(password),
            special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
        };

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
        reqLength.classList.toggle('met', requirements.length);
        reqUpper.classList.toggle('met', requirements.upper);
        reqLower.classList.toggle('met', requirements.lower);
        reqNumber.classList.toggle('met', requirements.number);
        reqSpecial.classList.toggle('met', requirements.special);

        // –ü–æ–¥—Å—á–µ—Ç —Å–∏–ª—ã
        if (requirements.length) strength++;
        if (requirements.upper) strength++;
        if (requirements.lower) strength++;
        if (requirements.number) strength++;
        if (requirements.special) strength++;

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–ª—ã
        if (password.length === 0) {
            passwordStrength.classList.remove('show');
            passwordRequirements.classList.remove('show');
            strengthFill.className = 'strength-fill';
            strengthText.textContent = '–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å';
        } else {
            passwordStrength.classList.add('show');
            passwordRequirements.classList.add('show');

            if (strength <= 1) {
                strengthFill.className = 'strength-fill weak';
                strengthText.textContent = '–°–ª–∞–±—ã–π';
                strengthText.style.color = '#e53e3e';
            } else if (strength <= 2) {
                strengthFill.className = 'strength-fill fair';
                strengthText.textContent = '–°—Ä–µ–¥–Ω–∏–π';
                strengthText.style.color = '#dd6b20';
            } else if (strength <= 3) {
                strengthFill.className = 'strength-fill good';
                strengthText.textContent = '–•–æ—Ä–æ—à–∏–π';
                strengthText.style.color = '#d69e2e';
            } else {
                strengthFill.className = 'strength-fill strong';
                strengthText.textContent = '–ù–∞–¥–µ–∂–Ω—ã–π';
                strengthText.style.color = '#38a169';
            }
        }

        return strength >= 3; // –ú–∏–Ω–∏–º—É–º 3 –∏–∑ 5 —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π
    }

    function checkPasswordMatch() {
        const password = passwordInput.value;
        const confirm = confirmInput.value;

        if (confirm.length === 0) {
            confirmHint.textContent = '–ü–∞—Ä–æ–ª–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å';
            confirmHint.style.color = '#718096';
            return false;
        } else if (password === confirm) {
            confirmHint.textContent = '–ü–∞—Ä–æ–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
            confirmHint.style.color = '#38a169';
            return true;
        } else {
            confirmHint.textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
            confirmHint.style.color = '#e53e3e';
            return false;
        }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    validateForm();
});
</script>
{% endblock %}