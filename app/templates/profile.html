{% extends "base.html" %}
{% block content %}
<div class="profile-container">
    <div class="profile-header">
        <div class="profile-avatar">
            <i class="fas fa-user-circle"></i>
        </div>
        <div class="profile-info">
            <h1 class="profile-title">Личный кабинет</h1>
            <p class="profile-subtitle">Добро пожаловать, {{ user.fullname_user }}!</p>
        </div>
    </div>

    <div class="profile-content">
        <div class="figma-glass">
            <div class="card-header">
                <i class="fas fa-id-card"></i>
                <h3>Основная информация</h3>
            </div>
            <div class="card-body">
                <div class="info-row">
                    <div class="info-label">
                        <i class="fas fa-building"></i>
                        Компания:
                    </div>
                    <div class="info-value">{{ user.company_name_user }}</div>
                </div>
                <!-- В блоке card-body добавьте: -->
                <div class="info-row">
                    <div class="info-label">
                        <i class="fas fa-id-card"></i>
                        ИНН компании:
                    </div>
                    <div class="info-value">{{ user.inn_user }}</div>
                </div>
                <div class="info-row">
                    <div class="info-label">
                        <i class="fas fa-shield-alt"></i>
                        Роль:
                    </div>
                    <div class="info-value role-badge role-{{ user.role_user }}">
                        {% if user.role_user == 'buyer' %}
                            Покупатель
                        {% elif user.role_user == 'manager' %}
                            Менеджер
                        {% elif user.role_user == 'admin' %}
                            Администратор
                        {% else %}
                            {{ user.role_user }}
                        {% endif %}
                    </div>
                </div>
                {% if user.email %}
                <div class="info-row">
                    <div class="info-label">
                        <i class="fas fa-envelope"></i>
                        Email:
                    </div>
                    <div class="info-value">{{ user.email_user }}</div>
                </div>
                {% endif %}
                {% if user.phone_user %}
                <div class="info-row">
                    <div class="info-label">
                        <i class="fas fa-phone"></i>
                        Телефон:
                    </div>
                    <div class="info-value" id="phoneDisplay">{{ user.phone_user }}</div>
                </div>
                {% endif %}
                {% if user.full_name %}
                <div class="info-row">
                    <div class="info-label">
                        <i class="fas fa-signature"></i>
                        Полное имя:
                    </div>
                    <div class="info-value">{{ user.fullname_user }}</div>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="profile-actions">
            <div class="action-card figma-glass">
                <div class="action-icon">
                    <i class="fas fa-shopping-bag"></i>
                </div>
                <div class="action-content">
                    <h4>Мои заказы</h4>
                    <p>Просмотр истории заказов и текущих заказов</p>
                    <a href="{{ url_for('buyer.orders') }}" class="action-btn">
                        <span>Перейти к заказам</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>

            <div class="action-card figma-glass">
                <div class="action-icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="action-content">
                    <h4>Корзина</h4>
                    <p>Управление товарами в корзине</p>
                    <a href="{{ url_for('buyer.cart') }}" class="action-btn">
                        <span>Перейти в корзину</span>
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>

            <div class="action-card figma-glass">
                <div class="action-icon">
                    <i class="fas fa-comments me-2"></i>
                </div>
                <div class="action-content">
                    <h4>Сообщения</h4>
                    <p>Общайтесь с менеджером по заказам и не только</p>
                    <a href="#" class="action-btn disabled">
                        <span>Скоро доступно</span>
                        <i class="fas fa-clock"></i>
                    </a>
                </div>
            </div>

            <div class="action-card figma-glass">
                <div class="action-icon">
                    <i class="fas fa-cog"></i>
                </div>
                <div class="action-content">
                    <h4>Настройки</h4>
                    <p>Изменение личных данных и пароля</p>
                    <li class="nav-item">
                        <a class="action-btn" href="{{ url_for('buyer.settings') }}">
                            <span>Перейти в настройки</span>
                            <i class="fas fa-arrow-right"></i>
                        </a>
                    </li>
                </div>
            </div>

            <!-- Кнопка выхода -->
            <div class="action-card logout-card figma-glass">
                <div class="action-icon logout-icon">
                    <i class="fas fa-sign-out-alt"></i>
                </div>
                <div class="action-content">
                    <h4>Выход</h4>
                    <p>Завершение текущей сессии</p>
                    <a href="{{ url_for('buyer.logout') }}" class="action-btn logout-btn" onclick="return confirm('Вы уверены, что хотите выйти?')">
                        <span>Выйти из аккаунта</span>
                        <i class="fas fa-sign-out-alt"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.profile-container {
    margin: 0 auto;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.profile-header {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 40px;
    background: var(--secondary-gradient);
    padding: 30px;
    border-radius: 20px;
    color: white;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
}

.profile-avatar {
    font-size: 60px;
    opacity: 0.9;
}

.profile-info {
    flex: 1;
}

.profile-title {
    font-size: 32px;
    font-weight: 700;
    margin: 0 0 5px 0;
    color: white;
}

.profile-subtitle {
    font-size: 16px;
    opacity: 0.9;
    margin: 0;
    font-weight: 400;
}

.profile-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
}

.profile-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid #e2e8f0;
    overflow: hidden;
}

.card-header {
    padding: 20px 25px;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    align-items: center;
    gap: 12px;
}

.card-header i {
    font-size: 20px;
    color: #667eea;
}

.card-header h3 {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
    color: white;
}

.card-body {
    padding: 25px;
}

.info-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid #f7fafc;
}

.info-row:last-child {
    border-bottom: none;
}

.info-label {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 500;
    color: white;
    font-size: 14px;
}

.info-label i {
    width: 16px;
    color: #718096;
}

.info-value {
    font-weight: 600;
    color: white;
}

.role-badge {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.role-buyer {
    background: #3cffd824;
    color: #3cffd8;
    border: 1px solid #81e6d9;
}

.role-manager {
    background: #ebf8ff70;
    color: #1a365d;
    border: 1px solid #90cdf4;
}

.role-admin {
    background: #fef5e770;
    color: #744210;
    border: 1px solid #fbd38d;
}

.profile-actions {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.action-card {
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    padding: 25px;
    display: flex;
    align-items: flex-start;
    gap: 20px;
    transition: all 0.3s ease;
}

.action-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
}

.action-icon {
    width: 50px;
    height: 50px;
    background: var(--secondary-gradient);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 20px;
    flex-shrink: 0;
}

.action-content {
    flex: 1;
}

.action-content h4 {
    margin: 0 0 8px 0;
    font-size: 18px;
    font-weight: 600;
    color: white;
}

.action-content p {
    margin: 0 0 15px 0;
    color: white;
    font-size: 14px;
    line-height: 1.4;
}

.action-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    background: var(--secondary-gradient);
    color: white;
    text-decoration: none;
    border-radius: 10px;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
}

.action-btn:hover {
    background: #5a6fd8;
    transform: translateX(5px);
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
}

.action-btn.disabled {
    background: #cbd5e0;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}

.action-btn.disabled:hover {
    background: #cbd5e0;
    transform: none;
    box-shadow: none;
}

/* Стили для карточки выхода */
.logout-card {
    background: rgb(255 0 0 / 10%);
}

.logout-icon {
    background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
}

.logout-btn {
    background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
}

.logout-btn:hover {
    background: linear-gradient(135deg, #c53030 0%, #9b2c2c 100%);
    transform: translateX(5px);
    box-shadow: 0 4px 15px rgba(229, 62, 62, 0.4);
}

/* Адаптивность */
@media (max-width: 768px) {
    .profile-container {
        padding: 20px 15px;
    }

    .profile-header {
        flex-direction: column;
        text-align: center;
        padding: 25px 20px;
    }

    .profile-avatar {
        font-size: 50px;
    }

    .profile-title {
        font-size: 28px;
    }

    .profile-content {
        grid-template-columns: 1fr;
        gap: 20px;
    }

    .action-card {
        flex-direction: column;
        text-align: center;
        gap: 15px;
    }

    .info-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
    }

    .card-body {
        padding: 20px;
    }
}

@media (max-width: 480px) {
    .profile-header {
        padding: 20px 15px;
        border-radius: 16px;
    }

    .profile-title {
        font-size: 24px;
    }

    .action-card {
        padding: 20px;
    }

    .action-icon {
        width: 45px;
        height: 45px;
        font-size: 18px;
    }
}

/* Анимации */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.profile-header {
    animation: fadeInUp 0.6s ease-out;
}

.profile-card {
    animation: fadeInUp 0.6s ease-out 0.1s both;
}

.action-card:nth-child(1) {
    animation: fadeInUp 0.6s ease-out 0.2s both;
}

.action-card:nth-child(2) {
    animation: fadeInUp 0.6s ease-out 0.3s both;
}

.action-card:nth-child(3) {
    animation: fadeInUp 0.6s ease-out 0.4s both;
}

.action-card:nth-child(4) {
    animation: fadeInUp 0.6s ease-out 0.5s both;
}
</style>

<script>
// Подтверждение выхода
document.addEventListener('DOMContentLoaded', function() {
    const logoutBtn = document.querySelector('.logout-btn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', function(e) {
            if (!confirm('Вы уверены, что хотите выйти из аккаунта?')) {
                e.preventDefault();
            }
        });
    }
});

document.addEventListener('DOMContentLoaded', function() {
    // Форматируем телефон при загрузке страницы
    const phoneDisplay = document.getElementById('phoneDisplay');
    if (phoneDisplay) {
        const originalPhone = phoneDisplay.textContent;
        const formattedPhone = formatPhoneNumberDisplay(originalPhone);
        if (formattedPhone) {
            phoneDisplay.textContent = formattedPhone;
        }
    }

    // Подтверждение выхода
    const logoutBtn = document.querySelector('.logout-btn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', function(e) {
            if (!confirm('Вы уверены, что хотите выйти из аккаунта?')) {
                e.preventDefault();
            }
        });
    }
});

// Функция для форматирования телефона
function formatPhoneNumberDisplay(phone) {
    if (!phone) return '';

    // Убираем все нецифровые символы
    let digits = phone.replace(/\D/g, '');

    // Если номер начинается с 7 или 8, убираем первую цифру
    if (digits.startsWith('7') || digits.startsWith('8')) {
        digits = digits.substring(1);
    }

    // Форматируем в красивый вид
    let formatted = '+7 ';

    if (digits.length > 0) {
        formatted += '(' + digits.substring(0, 3);
    }
    if (digits.length > 3) {
        formatted += ') ' + digits.substring(3, 6);
    }
    if (digits.length > 6) {
        formatted += '-' + digits.substring(6, 8);
    }
    if (digits.length > 8) {
        formatted += '-' + digits.substring(8, 10);
    }

    return formatted;
}
</script>
{% endblock %}