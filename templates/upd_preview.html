<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>УПД — предпросмотр</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    /* Минимальная печатная верстка для PDF */
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #333; padding: 6px; font-size: 12px; }
    .no-border { border: none; }
    .right { text-align: right; }
  </style>
</head>
<body>
  <h2>Универсальный передаточный документ</h2>

  <h3>Продавец</h3>
  <p>{{ seller.name }}<br>{{ seller.address }}<br>ИНН/КПП: {{ seller.inn }} / {{ seller.kpp }}</p>

  <h3>Покупатель</h3>
  <p>{{ buyer.name }}<br>{{ buyer.address }}<br>ИНН/КПП: {{ buyer.inn }} / {{ buyer.kpp or '' }}</p>

  <h3>Товары / услуги</h3>
  <table>
    <thead>
      <tr>
        <th>№</th>
        <th>Наименование</th>
        <th>Кол-во</th>
        <th>Цена</th>
        <th>Сумма</th>
      </tr>
    </thead>
    <tbody>
      {% for it in items %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ it.name }}</td>
        <td class="right">{{ "%.2f"|format(it.qty) }}</td>
        <td class="right">{{ "%.2f"|format(it.price) }}</td>
        <td class="right">{{ "%.2f"|format(it.total) }}</td>
      </tr>
      {% endfor %}
      <tr>
        <td colspan="4" class="right"><strong>Итого</strong></td>
        <td class="right"><strong>{{ "%.2f"|format(total_sum) }}</strong></td>
      </tr>
    </tbody>
  </table>

  <form method="POST" action="{{ url_for('download') }}" id="downloadForm">
    <!-- Скрытый input с HTML, который мы отправим в /download -->
    <input type="hidden" name="html" id="htmlInput">
    <button type="button" onclick="downloadPDF()">Скачать PDF</button>
    <button type="button" onclick="window.print()">Печать / Предпросмотр печати</button>
  </form>

<script>
function downloadPDF(){
  // Возьмём текущий HTML страницы и передадим на сервер
  const html = document.documentElement.outerHTML;
  document.getElementById('htmlInput').value = html;
  document.getElementById('downloadForm').submit();
}
</script>

</body>
</html>
